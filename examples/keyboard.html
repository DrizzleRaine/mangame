<!DOCTYPE html>
<html>
<head>
<title>Keyboard | Mangame</title>
<script type="text/javascript" src="../src/mangame.core.js"></script>
<script type="text/javascript" src="../src/mangame.geom.js"></script>
<script type="text/javascript" src="../src/mangame.ui.js"></script>
<script type="text/javascript">
var SceneTest = Scene2D.extend({

    init : function(game) {
        this._super(game);
        var self = this;

        this.hero = new Rectangle(game.canvas, 270, 150, 40, 40, 10);
        this.hero.stroke.color = "black";
        this.hero.fill.color = "yellow";

        this.description = new Text(game.canvas, game.canvas.width / 2, game.canvas.height - 50, "Use arrow keys to move the square");
        this.description.align = "center";

        this.keyLabel = new Text(game.canvas, game.canvas.width / 2, game.canvas.height - 30, "----");
        this.keyLabel.align = "center";
        this.keyLabel.color = "red";

        this.walkingX = 0;
        this.walkingY = 0;
        this.speed = 5;

        game.keyboard.addEventListener(Keyboard.KEY_DOWN, function(e) { self.moveHero(e) });
        game.keyboard.addEventListener(Keyboard.KEY_UP, function(e) { self.stopHero(e) });
        game.keyboard.addEventListener(Keyboard.KEY_DOWN, function(e) {
                self.keyLabel.content = "Key is down: code " + e.keyCode;
            }
        );

        this.appendChild(this.hero);
        this.appendChild(this.description);
        this.appendChild(this.keyLabel);
    },

    moveHero : function(e) {
        switch (e.keyCode) {
        case 37:
            this.walkingX = -1;
            break;
        case 38:
            this.walkingY = -1;
            break;
        case 39:
            this.walkingX = 1;
            break;
        case 40:
            this.walkingY = 1;
            break;
        }
    },

    stopHero : function(e) {
        switch (e.keyCode) {
        case 38:
        case 40:
            this.walkingY = 0;
            break;
        case 37:
        case 39:
            this.walkingX = 0;
            break;
        }
    },

    _updateImpl : function(elapsedTime) {
        this.hero.x += this.speed * this.walkingX;
        this.hero.y += this.speed * this.walkingY;
    }

})

window.onload = function() {

    var canvas = new Canvas("canvas");

    var game = new Game(canvas);
    game.showFps = true;

    var scene = new SceneTest(game);
    game.addScene(scene);

    game.play();

}
</script>
</head>
<body>
<canvas id="canvas" width="600" height="400">
    <p>Your browser doesn't support HTML5 Canvas</p>
</canvas>
</html>
